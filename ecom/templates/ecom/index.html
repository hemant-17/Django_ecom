
<!doctype html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Hello, world shop!</title>

    <style>
      .col-md-3{
        display: inline-block;
        margin-left:-4px;

      }
      .col-md-3 img{
        width: 255px;
        height: 200px;
      }
       .carousel-indicator {
        background-color: blue;
      }
       .carousel-control-prev,
       .carousel-control-next {
         top:auto;
         bottom: auto;
         max-width: 40px;




        background-color: rgb(1, 1, 14);
      }





    </style>
  </head>
  <body>
    {% load static %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">My Awesome Cart</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="/shop">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/about">About Us</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Category
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="#">Fashion</a>
              <a class="dropdown-item" href="#">Electronics</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Kitchen Appliances</a>
            </div>
          </li>
          <!--<li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"></a>
          </li>-->
          <li class="nav-item">
            <a class="nav-link" href="/shop/contact">Contact Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/tracker">Tracker</a>
          </li>


        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
        <button type="button" class="btn btn-secondary mx-2" id="popcart" data-container="body" data-toggle="popover" data-html="true" data-placement="bottom" >
Cart(<span id="cart"> </span>)
</button>
      </div>
      <a href='/shop/checkout'><button class='btn btn-primary' id ='checkout'>Checkout</button></a>
      <button class='btn btn-primary mx-2' onclick='clearcart()' id='clearcart'>clear cart</button>
    </nav>

<div class=container>
  {% for product , range , nslides in allprods %}
           <h5> Flash sale on {{ product.0.category}}</h5>
           <div class="row">

    <div id="demo{{forloop.counter}}" class="col carousel slide" data-ride="carousel">
          <ul class="carousel-indicators">
            <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>

            {% for i in range %}
            <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{i}}" ></li>
           {% endfor %}
          </ul>
      <div class="container carousel-inner no-padding">


            <div class="carousel-item active">


             {% for i in product %}

          <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card align-items-center" style="width: 18rem;">
                <img src='/media/{{i.image}}' class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" id="namepr{{i.id}}">{{i.product_name}}</h5>
                  <p class="card-text">{{i.desc}}</p>
                  <h6 class="card-title" >â‚¹: <span id="pricepr{{i.id}}">{{i.price}}</span></h6>
                  <span id="divpr{{i.id}}" class="divpr">
                  <button id="pr{{i.id}}" class="btn btn-primary cart">ADD TO CART</button></span>
                 <a href="/shop/products/{{i.id}}"> <button id="qv{{i.id}}" class="btn btn-primary cart">Quick View</button></a>
                </div>
              </div>
            </div>
            {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}

      </div> <div class="carousel-item ">
            {% endif %}

            {% endfor %}

          </div>
        </div>

      </div>














        <a class="carousel-control-prev" href=#demo{{forloop.counter}} data-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href=#demo{{forloop.counter}} data-slide="next">
          <span class="carousel-control-next-icon"></span>
        </a>
      </div>

      {% endfor %}
    </div>







        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
        </script>
        <script>

// Find out the cart items from localStorage
if (localStorage.getItem('cart') == null) {
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem('cart'));
    updateCart(cart);
}

          //if the add to cart button is clicked add/increment the item in cart
         // $('.cart').click(function()
          $('.divpr').on('click','button.cart',function()
          {

            var idstr=this.id;
           // console.log(idstr);
            if(cart[idstr]!=undefined)
            {
              qty=cart[idstr][0] + 1;
              //name="my item";
             //w cart[idstr] = [ qty, name ];
            }
            else{
              qty=1;
              name=document.getElementById('name'+idstr).innerHTML;
              price = document.getElementById('price'+idstr).innerHTML;
              cart[idstr] = [qty, name, parseInt(price)];
              //cart[idstr]=[ qty , name];

            }
            //console.log(cart);
            //localStorage.setItem('cart' , JSON.stringify(cart));
            updateCart(cart);


          } );


          //add popover to cart
          $('#popcart').popover()
          updatepopover(cart);
          function updatepopover(cart){
            console.log("we are inside popover");
            var popstr = "";
            popstr = popstr+ "<h5> cart items </h5><div class=mx-2 my-2> ";
            var i=1;
            for(var item in cart){
            popstr = popstr + "<b>" + i +"</b> .";
            popstr = popstr + document.getElementById('name'+item).innerHTML + "..Qty:" + cart[item][0] +'<br>';
            i=i+1;
          }

          popstr = popstr +"</div> <a href ='/shop/checkout'><button class='btn btn-primary' id='checkout'>checkout</button> </a> <button class='btn btn-primary' onclick='clearcart()' id='clearcart'>checkout</button> "


          document.getElementById('popcart').setAttribute('data-content',popstr);
          $('#popcart').popover('show');
          }







          //clear cart function
          function clearcart(){
            cart = JSON.parse(localStorage.getItem('cart'));
            for (var item in cart){
              document.getElementById('div' +item).innerHTML = '<button id="' + item + '" class="btn btn-primary cart">ADD TO CART</button>'
              localStorage.clear();
              cart = {};
              updateCart(cart);


            }

          }
          //cart updation function

          function updateCart(cart)
          {

            for(var item in cart){
              document.getElementById('div'+ item).innerHTML= "<button id='minus" + item + "'class='btn btn-primary minus'>-</button> <span id ='val" + item + "''>" + cart[item][0]
              + " </span>  <button id='plus" + item + "'class='btn btn-primary plus'> + </button>"

            }
            localStorage.setItem('cart',JSON.stringify(cart));
            document.getElementById('cart').innerHTML = Object.keys(cart).length;
            console.log(cart);
            updatepopover(cart);

          }


          //if plus or minus button is clicked
          $('.divpr').on("click" , "button.minus" , function(){
            console.log("minus clicked ");
            a=this.id.slice(7, );
            console.log(a);
            cart['pr'+a][0] = cart['pr'+a][0] - 1;
            document.getElementById('valpr'+a).innerHTML = cart['pr' +a][0];
            updateCart(cart);

          } );
          $('.divpr').on("click" , "button.plus" , function(){
            console.log("plus clicked ");
            a=this.id.slice(6, );
            cart['pr'+a][0] = cart['pr'+a][0] + 1;
            document.getElementById('valpr'+a).innerHTML = cart['pr' +a][0];
            updateCart(cart);

          } );






        </script>








  </body>
</html>
<!--

updatepopover(cart);
          function updatepopover(cart){
            console.log("we are inside popover");
            var popstr = "";
            popstr = popstr+ "<h5> cart items </h5><div class=mx-2 my-2> ";
            var i=1;
            for(var item in cart){
            popstr = popstr + "<b>" + i +"</b> .";
            popstr = popstr + document.getElementById('name'+item).innerHTML + "..Qty:" + cart[item] +'<br>';
            i=i+1;
          }

          popstr = popstr +"</div> <a href ='/shop/checkout'><button class='btn btn-primary' id='checkout'>checkout</button> </a> <button class='btn btn-primary' onclick='clearcart()' id='clearcart'>checkout</button> "


          document.getElementById('popcart').setAttribute('data-content',popstr);
          $('#popcart').popover('show');
          }

-->